<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="report name" pageWidth="612" pageHeight="792" whenNoDataType="BlankPage" columnWidth="535" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" whenResourceMissingType="Empty">
	<parameter name="p_nombreLocal" class="java.lang.String"/>
	<parameter name="p_nit" class="java.lang.String"/>
	<parameter name="p_titulo" class="java.lang.String"/>
	<parameter name="p_tercero" class="java.lang.String"/>
	<parameter name="p_direccion" class="java.lang.String"/>
	<parameter name="p_idLocal" class="java.lang.Integer"/>
	<parameter name="p_fechaInicialSqlServer" class="java.lang.String"/>
	<parameter name="p_fechaFinalSqlServer" class="java.lang.String"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["C:\\proyectoWeb\\Commerce\\web\\WEB-INF\\reports\\"]]></defaultValueExpression>
	</parameter>
	<parameter name="p_indicadorINI" class="java.lang.Integer"/>
	<parameter name="p_idVendedor" class="java.lang.Double"/>
	<parameter name="p_idTipoOrdenINI" class="java.lang.Integer"/>
	<parameter name="p_indicadorFIN" class="java.lang.Integer"/>
	<parameter name="p_idTipoOrdenFIN" class="java.lang.Integer"/>
	<parameter name="p_ipServidor" class="java.lang.String"/>
	<parameter name="p_puerto" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT	tmpRVR.referencia,
		tmpRVR.nombrePlu,
		tmpRVR.nombreTercero,
		tmpRVR.fechaDcto,
		tmpRVR.idDcto,
		(tmpRVR.cantidadFacturada * tmpRVR.vrVentaUnitarioSinIva ) as vrBase,
		tmpRVR.pesoFacturado,
		tmpRVR.cantidadFacturada,
		tmpRVR.nombreNegocio,
		tmpRVR.aliasUsuario		

FROM
(SELECT	tblDctosOrdenesDetalle.IDTIPOORDEN,
		tblDctosOrdenesDetalle.IDORDEN,
		tblDctosOrdenesDetalle.IDPLU,
		tblPlus.nombrePlu AS NOMBREPLU,
		tblPlus.referencia,
		tblDctosOrdenes.idFicha,
		tblDctosOrdenesDetalle.CANTIDAD,
		tblDctosOrdenesDetalle.CANTIDADPEDIDA,
		tblDctosOrdenesDetalle.pesoEntregado,
		tblDctosOrdenesDetalle.pesoFacturado,
		tblDctosOrdenesDetalle.pesoTerminado,
		tblDctosOrdenesDetalle.cantidadEntregada,
		tblDctosOrdenesDetalle.cantidadFacturada,
		tblDctosOrdenesDetalle.cantidadTerminada,
		tblDctosOrdenesDetalle.vrCostoIND,
		tblDctosOrdenesDetalle.vrCostoOriginal,
		tblDctosOrdenesDetalle.vrVentaUnitarioSinIva,
		tblDctosOrdenesDetalle.PORCENTAJEIVA,
		tblDctosOrdenesDetalle.fechaEntrega,
		tblDctosOrdenesDetalle.idOperacion,
		tblDctos.fechaDcto,
		tblDctos.IDORDEN as Orden,
		tblDctos.idDcto,
		tblDctos.idCliente,
		tblDctos.nombreTercero,
		tblDctos.diasPlazo,
		tblDctos.idVendedor,
		tblDctos.idTipoNegocio,
		(case when idTipoNegocio = 1 
                THEN 'CONTADO' 
                ELSE 'CREDITO' END ) AS nombreNegocio,
		tblDctos.indicador,
		ctrlUsuarios.aliasUsuario
FROM tblDctosOrdenesDetalle
inner join tblDctos
on tblDctosOrdenesDetalle.IDORDEN = tblDctos.IDORDEN
inner join tblDctosOrdenes
on tblDctosOrdenes.IDORDEN = tblDctosOrdenesDetalle.IDORDEN
inner join tblPlus
on tblPlus.idPlu = tblDctosOrdenesDetalle.IDPLU
inner join ctrlUsuarios
on ctrlUsuarios.idUsuario = tblDctos.idVendedor
WHERE tblDctos.fechaDcto BETWEEN $P{p_fechaInicialSqlServer} 
					AND	$P{p_fechaFinalSqlServer}
AND ( tblDctos.idTipoOrden  = $P{p_idTipoOrdenINI}
                           OR tblDctos.idTipoOrden = $P{p_idTipoOrdenFIN})
AND tblDctos.idVendedor     = $P{p_idVendedor}) AS tmpRVR]]>
	</queryString>
	<field name="referencia" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="nombrePlu" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="idDcto" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="fechaDcto" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="vrBase" class="java.lang.Double">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="nombreTercero" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="nombreNegocio" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="aliasUsuario" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="pesoFacturado" class="java.lang.Double"/>
	<field name="cantidadFacturada" class="java.lang.Double"/>
	<variable name="sumaVrBase" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{vrBase}]]></variableExpression>
	</variable>
	<variable name="sumaPesoFac" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{pesoFacturado}]]></variableExpression>
	</variable>
	<variable name="sumaCanFact" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{cantidadFacturada}]]></variableExpression>
	</variable>
	<background>
		<band/>
	</background>
	<title>
		<band/>
	</title>
	<pageHeader>
		<band height="62">
			<textField>
				<reportElement x="12" y="1" width="555" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" size="14" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{p_nombreLocal}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="12" y="21" width="555" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" size="10" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{p_nit}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="13" y="41" width="554" height="20"/>
				<textElement textAlignment="Center"/>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{p_titulo}]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="12">
			<staticText>
				<reportElement x="311" y="0" width="35" height="12"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[F.FRA]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="0" width="39" height="12"/>
				<textElement textAlignment="Left">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[CODIGO]]></text>
			</staticText>
			<staticText>
				<reportElement x="181" y="0" width="128" height="12"/>
				<textElement textAlignment="Left">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[CLIENTE]]></text>
			</staticText>
			<staticText>
				<reportElement x="390" y="0" width="35" height="12"/>
				<textElement textAlignment="Right">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[V.BASE]]></text>
			</staticText>
			<staticText>
				<reportElement x="527" y="0" width="21" height="12"/>
				<textElement textAlignment="Left">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[NEG]]></text>
			</staticText>
			<staticText>
				<reportElement x="550" y="0" width="22" height="12"/>
				<textElement textAlignment="Left">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[USR]]></text>
			</staticText>
			<staticText>
				<reportElement x="40" y="0" width="136" height="12"/>
				<textElement textAlignment="Left">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[REFERENCIA]]></text>
			</staticText>
			<staticText>
				<reportElement x="351" y="0" width="35" height="12"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[DCTO]]></text>
			</staticText>
			<staticText>
				<reportElement x="433" y="0" width="45" height="12"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[PES.FACT]]></text>
			</staticText>
			<staticText>
				<reportElement x="479" y="0" width="46" height="12"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[CAN.FACT]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="12">
			<elementGroup/>
			<textField hyperlinkType="Reference">
				<reportElement x="0" y="0" width="39" height="10" forecolor="#000000"/>
				<textElement textAlignment="Left">
					<font size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{referencia}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="181" y="0" width="128" height="10"/>
				<textElement>
					<font size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{nombreTercero}]]></textFieldExpression>
			</textField>
			<textField pattern="yyyy/MM/dd">
				<reportElement x="311" y="0" width="35" height="10"/>
				<textElement textAlignment="Center">
					<font size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{fechaDcto}.substring(0,10)]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="390" y="0" width="35" height="10"/>
				<textElement textAlignment="Right">
					<font size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$F{vrBase}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="550" y="0" width="22" height="10"/>
				<textElement textAlignment="Left">
					<font size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{aliasUsuario}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="527" y="0" width="21" height="10"/>
				<textElement>
					<font size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{nombreNegocio}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="40" y="0" width="136" height="10"/>
				<textElement>
					<font size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{nombrePlu}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="351" y="0" width="35" height="10"/>
				<textElement textAlignment="Center">
					<font size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{idDcto}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement x="433" y="0" width="32" height="10"/>
				<textElement textAlignment="Right">
					<font size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$F{pesoFacturado}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="480" y="0" width="30" height="10"/>
				<textElement textAlignment="Right">
					<font size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$F{cantidadFacturada}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band/>
	</columnFooter>
	<summary>
		<band height="54">
			<line>
				<reportElement x="210" y="29" width="357" height="1"/>
			</line>
			<staticText>
				<reportElement x="481" y="30" width="46" height="12"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[CAN.FACT]]></text>
			</staticText>
			<staticText>
				<reportElement x="435" y="30" width="45" height="12"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[PES.FACT]]></text>
			</staticText>
			<textField pattern="#,##0">
				<reportElement isPrintRepeatedValues="false" x="390" y="41" width="35" height="10"/>
				<textElement textAlignment="Right">
					<font size="6" isUnderline="false"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$V{sumaVrBase}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="212" y="31" width="99" height="12"/>
				<textElement textAlignment="Right">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTALES]]></text>
			</staticText>
			<staticText>
				<reportElement x="390" y="30" width="35" height="12"/>
				<textElement textAlignment="Right">
					<font fontName="Verdana" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[V.BASE]]></text>
			</staticText>
			<textField pattern="#,##0">
				<reportElement isPrintRepeatedValues="false" x="483" y="41" width="42" height="10"/>
				<textElement textAlignment="Center">
					<font size="6" isUnderline="false"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$V{sumaCanFact}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement isPrintRepeatedValues="false" x="435" y="41" width="43" height="10"/>
				<textElement textAlignment="Center">
					<font size="6" isUnderline="false"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$V{sumaPesoFac}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
